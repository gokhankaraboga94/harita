<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>harita.info | T√ºrkiye'nin Enleri</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, update, remove, get, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAKkEHHeHnfHSN0MpEcJoK4Ix9o2PFbPY8",
            authDomain: "harita-4b58b.firebaseapp.com",
            projectId: "harita-4b58b",
            storageBucket: "harita-4b58b.firebasestorage.app",
            messagingSenderId: "778047554386",
            appId: "1:778047554386:web:41f29d854399a1d878b08b",
            measurementId: "G-ZNSZZC3HVS",
            databaseURL: "https://harita-4b58b-default-rtdb.firebaseio.com"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        window.db = db;
        window.dbRef = ref;
        window.dbPush = push;
        window.dbSet = set;
        window.dbUpdate = update;
        window.adaylar = [];
        window.bekleyenAdaylar = [];
        window.cityWinnersCache = { male: {}, female: {} };

        // ≈ûehir birincilerini hesapla ve cache'le
        function updateCityWinnersCache() {
            const maleWinners = {};
            const femaleWinners = {};

            for (let i = 1; i <= 81; i++) {
                const maleLeader = (window.adaylar || [])
                    .filter(a => a.city == i && a.gender === 'male')
                    .sort((a, b) => (b.votes || 0) - (a.votes || 0))[0];
                
                const femaleLeader = (window.adaylar || [])
                    .filter(a => a.city == i && a.gender === 'female')
                    .sort((a, b) => (b.votes || 0) - (a.votes || 0))[0];

                if (maleLeader) maleWinners[i] = maleLeader;
                if (femaleLeader) femaleWinners[i] = femaleLeader;
            }

            window.cityWinnersCache = { male: maleWinners, female: femaleWinners };
        }

        // Onaylƒ± Adaylar - Ger√ßek zamanlƒ± dinleme
        onValue(ref(db, 'adaylar'), (snapshot) => {
            const data = snapshot.val();
            window.adaylar = data ? Object.keys(data).map(k => ({ id: k, ...data[k] })) : [];
            updateCityWinnersCache();
            renderMaps();
            
            // Winners sekmesi a√ßƒ±ksa g√ºncelle
            if (document.getElementById('paneWinners').classList.contains('mobile-active')) {
                renderWinners();
            }
        });

        // Bekleyen Adaylar (Moderasyon) - Ger√ßek zamanlƒ±
        onValue(ref(db, 'bekleyen_adaylar'), (snapshot) => {
            const data = snapshot.val();
            window.bekleyenAdaylar = data ? Object.keys(data).map(k => ({ id: k, ...data[k] })) : [];
            
            // Admin sayfasƒ±ndaysa hemen render et
            if (isAdminPage()) {
                renderModPanel();
            }
        });

        // G√∂rsel Base64'e √áevirme
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Yarƒ±≈ümacƒ± Ba≈üvurusu
        window.submitAday = async () => {
            if (localStorage.getItem('user_has_joined')) return showToast("Zaten katƒ±ldƒ±nƒ±z!", "warning");

            if (window.dbSizeLimitReached) {
                return showToast("Veritabanƒ± kapasitesi doldu. Yeni ba≈üvuru kabul edilemiyor.", "error");
            }

            const gender = document.getElementById('upGender').value;
            const city = parseInt(document.getElementById('upCity').value);
            const name = document.getElementById('upName').value.trim();
            const instagram = document.getElementById('upInstagram').value.trim();
            const file = document.getElementById('upFile').files[0];
            const privacyAccepted = document.getElementById('privacyAccept').checked;

            if (!privacyAccepted) {
                return showToast("Gizlilik Politikasƒ±'nƒ± kabul etmeniz gerekmektedir.", "error");
            }

            // Instagram zorunlu kontrol√º
            if (!instagram) {
                return showToast("Instagram kullanƒ±cƒ± adƒ± zorunludur!", "error");
            }

            // Instagram format kontrol√º
            const igUsername = instagram.replace('@', '').trim();
            if (igUsername.length < 1 || !/^[a-zA-Z0-9._]+$/.test(igUsername)) {
                return showToast("Ge√ßerli bir Instagram kullanƒ±cƒ± adƒ± girin!", "error");
            }

            if (!city || !name || !file || city < 1 || city > 81) {
                return showToast("L√ºtfen t√ºm zorunlu alanlarƒ± doldurun!", "error");
            }

            if (file.size > 3 * 1024 * 1024) {
                return showToast("G√∂rsel boyutu 3MB'dan k√º√ß√ºk olmalƒ±!", "error");
            }

            try {
                const submitBtn = document.getElementById('submitBtn');
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<span class="loading-spinner"></span> Y√ºkleniyor...';

                const base64 = await fileToBase64(file);
                
                // IP adresini al - birden fazla servis dene
                let clientIP = 'IP Alƒ±namadƒ±';
                console.log('IP adresi alƒ±nƒ±yor...');
                
                // ƒ∞lk √∂nce ipify dene
                try {
                    const ipResponse = await fetch('https://api.ipify.org?format=json');
                    if (ipResponse.ok) {
                        const ipData = await ipResponse.json();
                        clientIP = ipData.ip;
                        console.log('IP alƒ±ndƒ± (ipify):', clientIP);
                    }
                } catch (error) {
                    console.error('ipify ba≈üarƒ±sƒ±z:', error);
                }
                
                // Eƒüer hala IP alƒ±namadƒ±ysa alternatif dene
                if (clientIP === 'IP Alƒ±namadƒ±') {
                    try {
                        const altResponse = await fetch('https://api64.ipify.org?format=json');
                        if (altResponse.ok) {
                            const altData = await altResponse.json();
                            clientIP = altData.ip;
                            console.log('IP alƒ±ndƒ± (ipify v6):', clientIP);
                        }
                    } catch (altError) {
                        console.error('Alternatif IP servisi de ba≈üarƒ±sƒ±z:', altError);
                    }
                }

                // Tarih ve saat bilgisi
                const now = new Date();
                const timestampStr = now.toISOString();
                const timestampNum = now.getTime();

                // Veritabanƒ±na kaydet - D√úZ YAPI
                const newAdayRef = push(ref(db, 'bekleyen_adaylar'));
                const dataToSave = {
                    gender: gender,
                    city: city,
                    name: name,
                    instagram: igUsername,
                    img: base64,
                    votes: 0,
                    turkeyVotes: 0,
                    status: 'pending',
                    createdAt: timestampNum,
                    createdAtStr: timestampStr,
                    // KVKK bilgileri - nested deƒüil, d√ºz
                    kvkkAccepted: true,
                    kvkkAcceptedAt: timestampStr,
                    kvkkAcceptedTimestamp: timestampNum,
                    ipAddress: clientIP,  // Direkt ana seviyede
                    userAgent: navigator.userAgent || 'Bilinmiyor'
                };
                
                console.log('IP Adresi:', clientIP);
                console.log('Kaydedilecek KVKK verileri:', {
                    kvkkAccepted: dataToSave.kvkkAccepted,
                    kvkkAcceptedAt: dataToSave.kvkkAcceptedAt,
                    ipAddress: dataToSave.ipAddress,
                    userAgent: dataToSave.userAgent
                });

                // SET kullan, UPDATE deƒüil
                await set(newAdayRef, dataToSave);

                localStorage.setItem('user_has_joined', 'true');
                showToast("Ba≈üvurunuz alƒ±ndƒ±! Moderat√∂r onayƒ±ndan sonra yayƒ±nlanacak.", "success");
                console.log('Ba≈üvuru ba≈üarƒ±yla kaydedildi. IP:', clientIP);
                closeModal('uploadModal');
                updateBtn();
            } catch (e) {
                console.error('Ba≈üvuru hatasƒ±:', e);
                showToast("Hata: " + e.message, "error");
                const submitBtn = document.getElementById('submitBtn');
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'üì§ Ba≈üvuruyu G√∂nder';
            }
        };

        // Toast Bildirimi
        window.showToast = (message, type = 'info') => {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <span class="toast-icon">${type === 'success' ? '‚úì' : type === 'error' ? '‚úï' : type === 'warning' ? '‚ö†' : '‚Ñπ'}</span>
                <span class="toast-message">${message}</span>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        };

        // ≈ûehir Oylamasƒ±
        window.vote = async (id) => {
            const aday = window.adaylar.find(a => a.id === id);
            if (!aday) return showToast("Aday bulunamadƒ±!", "error");

            const cityId = aday.city;
            const gender = aday.gender;
            const userVoteCity = localStorage.getItem('user_vote_city');

            if (userVoteCity && parseInt(userVoteCity) !== cityId) {
                const votedCityName = cityNames[parseInt(userVoteCity) - 1];
                return showToast(`Sadece kendi ilinizde oy kullanabilirsiniz! Daha √∂nce ${votedCityName} ilinde oy kullandƒ±nƒ±z.`, "warning");
            }

            const voteKey = `city_vote_${gender}`;

            if (localStorage.getItem(voteKey)) {
                const votedId = localStorage.getItem(voteKey);
                if (votedId === id) {
                    return showToast("Bu adaya zaten oy verdiniz!", "warning");
                } else {
                    return showToast(`${cityNames[cityId - 1]} ilinde ${gender === 'male' ? 'erkek' : 'kadƒ±n'} kategorisinde zaten oy kullandƒ±nƒ±z!`, "warning");
                }
            }

            await update(ref(db, `adaylar/${id}`), { votes: (aday.votes || 0) + 1 });
            localStorage.setItem(voteKey, id);
            localStorage.setItem('user_vote_city', cityId.toString());

            showToast(`Oyunuz kaydedildi! ${cityNames[cityId - 1]} - ${gender === 'male' ? 'Erkek' : 'Kadƒ±n'}`, "success");
            closeModal('voteModal');
        };

        // T√ºrkiye Birinciliƒüi Oylamasƒ±
        window.voteTurkey = async (id) => {
            const aday = window.adaylar.find(a => a.id === id);
            if (!aday) return showToast("Aday bulunamadƒ±!", "error");

            const gender = aday.gender;
            const voteKey = `turkey_vote_${gender}`;

            if (localStorage.getItem(voteKey)) {
                const votedId = localStorage.getItem(voteKey);
                if (votedId === id) {
                    return showToast("Bu adaya zaten T√ºrkiye Birinciliƒüi oyunuzu verdiniz!", "warning");
                } else {
                    return showToast(`T√ºrkiye Birinciliƒüi'nde ${gender === 'male' ? 'erkek' : 'kadƒ±n'} kategorisinde zaten oy kullandƒ±nƒ±z!`, "warning");
                }
            }

            await update(ref(db, `adaylar/${id}`), { turkeyVotes: (aday.turkeyVotes || 0) + 1 });
            localStorage.setItem(voteKey, id);
            showToast(`T√ºrkiye Birinciliƒüi oyunuz kaydedildi! ${gender === 'male' ? 'Erkek' : 'Kadƒ±n'} kategorisi`, "success");
        };

        // Admin: Ba≈üvuruyu Onayla - Duplicate √∂nleme
        window.approveAday = async (id) => {
            const aday = window.bekleyenAdaylar.find(a => a.id === id);
            if (!aday) return showToast("Aday bulunamadƒ±!", "error");

            // Onay butonunu devre dƒ±≈üƒ± bƒ±rak
            const btn = document.querySelector(`[data-approve-id="${id}"]`);
            if (btn) {
                btn.disabled = true;
                btn.innerHTML = '<span class="loading-spinner-small"></span>';
            }

            try {
                // Aynƒ± ≈üehir ve cinsiyette duplicate kontrol√º
                const existingAdaylar = window.adaylar.filter(
                    a => a.city === aday.city && a.gender === aday.gender && a.name === aday.name
                );

                if (existingAdaylar.length > 0) {
                    showToast("Bu aday zaten onaylanmƒ±≈ü!", "warning");
                    await remove(ref(db, `bekleyen_adaylar/${id}`));
                    return;
                }

                // √ñnce bekleyen adaydan sil
                await remove(ref(db, `bekleyen_adaylar/${id}`));

                // Sonra adaylara ekle
               const newAdayRef = push(ref(db, 'adaylar'));
await update(newAdayRef, {
    gender: aday.gender,
    city: aday.city,
    name: aday.name,
    instagram: aday.instagram,
    img: aday.img,
    votes: 0,
    turkeyVotes: 0,
    createdAt: aday.createdAt || Date.now(),
    
    // Eksik alanlarƒ± buraya ekleyin:
    ipAddress: aday.ipAddress || null,
    userAgent: aday.userAgent || null,
    kvkkAccepted: aday.kvkkAccepted || false,
    kvkkAcceptedAt: aday.kvkkAcceptedAt || null
});

                showToast("Ba≈üvuru onaylandƒ±!", "success");
            } catch (e) {
                showToast("Hata: " + e.message, "error");
                if (btn) {
                    btn.disabled = false;
                    btn.innerHTML = '‚úì Onayla';
                }
            }
        };

        // Admin: Ba≈üvuruyu Reddet
        window.rejectAday = async (id) => {
            if (!confirm("Bu ba≈üvuruyu reddetmek istediƒüinize emin misiniz?")) return;
            
            const btn = document.querySelector(`[data-reject-id="${id}"]`);
            if (btn) {
                btn.disabled = true;
                btn.innerHTML = '<span class="loading-spinner-small"></span>';
            }

            try {
                await remove(ref(db, `bekleyen_adaylar/${id}`));
                showToast("Ba≈üvuru reddedildi.", "info");
            } catch (e) {
                showToast("Hata: " + e.message, "error");
                if (btn) {
                    btn.disabled = false;
                    btn.innerHTML = '‚úó Reddet';
                }
            }
        };

        // Admin Panelini Render Et - Optimized
        window.renderModPanel = () => {
            const panel = document.getElementById('modPanel');
            if (!panel) return;

            const count = document.getElementById('pendingCount');
            if (count) count.innerText = window.bekleyenAdaylar.length;

            if (window.bekleyenAdaylar.length === 0) {
                panel.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <p>Bekleyen ba≈üvuru yok</p>
                    </div>
                `;
                return;
            }

            // Lazy loading i√ßin sadece g√∂r√ºnen g√∂rselleri y√ºkle
            panel.innerHTML = window.bekleyenAdaylar.map(a => `
                <div class="pending-card" data-id="${a.id}">
                    <div class="pending-card-header">
                        <img src="${a.img}" alt="${a.name}" class="pending-avatar" loading="lazy">
                        <div class="pending-info">
                            <h3>${a.name}</h3>
                            <div class="pending-meta">
                                <span class="badge badge-city">${a.city} - ${window.cityNames[a.city - 1]}</span>
                                <span class="badge ${a.gender === 'male' ? 'badge-male' : 'badge-female'}">
                                    ${a.gender === 'male' ? '‚ôÇ Erkek' : '‚ôÄ Kadƒ±n'}
                                </span>
                            </div>
                            <a href="https://instagram.com/${a.instagram}" target="_blank" class="instagram-link">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                                @${a.instagram}
                            </a>
                        </div>
                    </div>
                    <div class="pending-actions">
                        <button class="btn-approve" data-approve-id="${a.id}" onclick="approveAday('${a.id}')">‚úì Onayla</button>
                        <button class="btn-reject" data-reject-id="${a.id}" onclick="rejectAday('${a.id}')">‚úó Reddet</button>
                    </div>
                </div>
            `).join('');

            renderTurkeyWinnersAdmin();
            checkDatabaseSize();
        };

        // Admin Panel - T√ºrkiye Birincileri
        window.renderTurkeyWinnersAdmin = () => {
            const container = document.getElementById('turkeyWinnersAdmin');
            if (!container) return;

            const { maleWinners, femaleWinners } = getCityWinners();

            const turkeyMaleWinner = [...maleWinners].sort((a, b) => (b.turkeyVotes || 0) - (a.turkeyVotes || 0))[0];
            const turkeyFemaleWinner = [...femaleWinners].sort((a, b) => (b.turkeyVotes || 0) - (a.turkeyVotes || 0))[0];

            const renderWinnerCard = (winner, title, color) => {
                if (!winner) {
                    return `
                        <div class="winner-card winner-card-empty">
                            <h3>${title}</h3>
                            <p>Hen√ºz yeterli veri yok</p>
                        </div>
                    `;
                }

                return `
                    <div class="winner-card" style="--accent-color: ${color}">
                        <div class="winner-badge">üèÜ</div>
                        <h3>${title}</h3>
                        <img src="${winner.img}" alt="${winner.name}" class="winner-avatar">
                        <h2>${winner.name}</h2>
                        <p class="winner-city">${winner.city} - ${winner.cityName}</p>
                        <div class="winner-stats">
                            <div class="stat">
                                <span class="stat-value">${winner.votes || 0}</span>
                                <span class="stat-label">≈ûehir Oyu</span>
                            </div>
                            <div class="stat stat-highlight">
                                <span class="stat-value">${winner.turkeyVotes || 0}</span>
                                <span class="stat-label">T√ºrkiye Oyu</span>
                            </div>
                        </div>
                        ${winner.instagram ? `
                            <a href="https://instagram.com/${winner.instagram}" target="_blank" class="winner-instagram">
                                üì∑ @${winner.instagram}
                            </a>
                        ` : ''}
                    </div>
                `;
            };

            container.innerHTML = `
                ${renderWinnerCard(turkeyMaleWinner, 'T√úRKƒ∞YE 1. ERKEK', '#0066cc')}
                ${renderWinnerCard(turkeyFemaleWinner, 'T√úRKƒ∞YE 1. KADIN', '#cc0066')}
            `;
        };

        // Sayfa G√∂sterme
        window.showPage = (page) => {
            document.getElementById('mainPage').style.display = 'none';
            document.getElementById('adminPage').style.display = 'none';
            document.getElementById('contactPage').style.display = 'none';
            document.getElementById('privacyPage').style.display = 'none';

            switch (page) {
                case 'main':
                    document.getElementById('mainPage').style.display = 'block';
                    document.title = 'harita.info | T√ºrkiye\'nin Enleri';
                    break;
                case 'admin':
                    document.getElementById('adminPage').style.display = 'block';
                    document.title = 'Admin Panel | harita.info';
                    renderModPanel();
                    break;
                case 'contact':
                    document.getElementById('contactPage').style.display = 'block';
                    document.title = 'ƒ∞leti≈üim | harita.info';
                    break;
                case 'privacy':
                    document.getElementById('privacyPage').style.display = 'block';
                    document.title = 'Gizlilik Politikasƒ± | harita.info';
                    break;
            }
        };

        // Modal Kapatma
        window.closeModal = (modalId) => {
            document.getElementById(modalId).style.display = 'none';
        };

        // Veritabanƒ± boyutu kontrol√º
        window.dbSizeLimitReached = false;

        async function checkDatabaseSize() {
            try {
                const adaylarCount = (window.adaylar || []).length;
                const bekleyenCount = (window.bekleyenAdaylar || []).length;
                const estimatedSize = (adaylarCount + bekleyenCount) * 500 * 1024;
                const limitSize = 1 * 1024 * 1024 * 1024;

                window.dbSizeLimitReached = estimatedSize >= limitSize;

                const statsDiv = document.getElementById('dbStats');
                if (statsDiv) {
                    const usedMB = (estimatedSize / (1024 * 1024)).toFixed(2);
                    const limitMB = (limitSize / (1024 * 1024)).toFixed(0);
                    const percentage = ((estimatedSize / limitSize) * 100).toFixed(1);

                    statsDiv.innerHTML = `
                        <div class="db-stats ${percentage > 80 ? 'db-warning' : 'db-healthy'}">
                            <h4>üìä Veritabanƒ± Durumu</h4>
                            <p>Kullanƒ±lan: <strong>${usedMB} MB</strong> / ${limitMB} MB</p>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${Math.min(percentage, 100)}%"></div>
                            </div>
                            <p class="db-percentage">${percentage}% kullanƒ±lƒ±yor</p>
                            ${window.dbSizeLimitReached ? '<p class="db-alert">‚ö†Ô∏è Limit a≈üƒ±ldƒ±! Yeni ba≈üvurular kapatƒ±ldƒ±.</p>' : ''}
                        </div>
                    `;
                }
            } catch (e) {
                console.log('DB boyutu kontrol hatasƒ±:', e);
            }
        }

        // Sayfa y√∂nlendirmesi
        function isAdminPage() {
            return window.location.pathname === '/adminpanel' || window.location.hash === '#/adminpanel';
        }

        function isContactPage() {
            return window.location.pathname === '/iletisim' || window.location.hash === '#/iletisim';
        }

        function isPrivacyPage() {
            return window.location.pathname === '/gizlilik' || window.location.hash === '#/gizlilik';
        }

        window.addEventListener('load', () => {
            if (isAdminPage()) {
                showPage('admin');
            } else if (isContactPage()) {
                showPage('contact');
            } else if (isPrivacyPage()) {
                showPage('privacy');
            }
        });
    </script>

    <style>
        :root {
            --primary-blue: #0066cc;
            --primary-pink: #cc0066;
            --gold: #d4af37;
            --dark: #0a0a0f;
            --darker: #050508;
            --surface: #12121a;
            --surface-light: #1a1a24;
            --text: #ffffff;
            --text-muted: #8888a0;
            --success: #00c853;
            --warning: #ffab00;
            --error: #ff1744;
            --gradient-blue: linear-gradient(135deg, #0066cc 0%, #0099ff 100%);
            --gradient-pink: linear-gradient(135deg, #cc0066 0%, #ff3399 100%);
            --gradient-gold: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
            --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            --shadow-glow-blue: 0 0 40px rgba(0, 102, 204, 0.3);
            --shadow-glow-pink: 0 0 40px rgba(204, 0, 102, 0.3);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--dark);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header */
        header {
            background: var(--darker);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            padding: 20px 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--gold) 0%, #fff 50%, var(--gold) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        .logo span {
            font-weight: 400;
            opacity: 0.7;
        }

        /* Join Button */
        .btn-join {
            background: var(--gradient-gold);
            color: #ffffff; /* Siyah yerine beyaz yaptƒ±k */
            border: none;
            padding: 12px 28px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 20px rgba(212, 175, 55, 0.3);
        }

        .btn-join:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(212, 175, 55, 0.4);
        }

        .btn-join:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .btn-joined {
            background: var(--success);
            box-shadow: 0 4px 20px rgba(0, 200, 83, 0.3);
        }

        /* Tab Controls */
        .tab-controls {
            display: flex;
            background: var(--surface);
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .tab-btn {
            flex: 1;
            padding: 18px 20px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .tab-btn::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 3px;
            border-radius: 3px 3px 0 0;
            transition: all 0.3s ease;
        }

        .tab-btn.active-male {
            color: var(--primary-blue);
        }

        .tab-btn.active-male::after {
            width: 60%;
            background: var(--gradient-blue);
        }

        .tab-btn.active-female {
            color: var(--primary-pink);
        }

        .tab-btn.active-female::after {
            width: 60%;
            background: var(--gradient-pink);
        }

        .tab-btn.active-winners {
            color: var(--gold);
        }

        .tab-btn.active-winners::after {
            width: 60%;
            background: var(--gradient-gold);
        }

        /* Main Container */
        .container {
            display: flex;
            flex: 1;
            min-height: calc(100vh - 180px);
        }

        .pane {
            flex: 1;
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 30px;
            overflow-y: auto;
        }

        .pane.mobile-active {
            display: flex;
        }

        .pane-male {
            background: linear-gradient(180deg, rgba(0,102,204,0.05) 0%, var(--dark) 100%);
        }

        .pane-female {
            background: linear-gradient(180deg, rgba(204,0,102,0.05) 0%, var(--dark) 100%);
        }

        .pane-winners {
            background: linear-gradient(180deg, rgba(212,175,55,0.05) 0%, var(--dark) 100%);
        }

        /* Map Grid */
     .map-grid {
    display: grid;
    /* Kartlarƒ± b√ºy√ºtmek i√ßin 9 yerine 7 s√ºtun yapƒ±yoruz */
    grid-template-columns: repeat(7, 1fr); 
    gap: 10px;
    max-width: 1000px; /* Geni≈üliƒüi biraz artƒ±rdƒ±k */
    width: 100%;
    padding: 20px;
    margin: 0 auto; /* Ortalamak i√ßin */
}

.city-cell {
    /* 1.2 yerine 0.85 yaparak kartlarƒ± boyuna uzatƒ±yoruz, bilgiler sƒ±ƒüsƒ±n */
    aspect-ratio: 0.85; 
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    background: var(--surface);
    border: 1px solid rgba(255,255,255,0.05);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 5px; /* Kenarlardan biraz bo≈üluk */
}
        .city-cell:hover {
            transform: scale(1.05);
            z-index: 10;
        }

        .city-cell.has-winner {
            border: 2px solid var(--gold);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
        }

        .city-cell.has-winner .city-avatar {
            width: 60%;
            height: 60%;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--gold);
        }

        .city-cell .city-number {
            font-size: 11px;
            font-weight: 700;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .city-cell .city-name {
                display: block; /* G√∂r√ºn√ºr yaptƒ±k */
                font-size: 6px; /* Mobilde kutular k√º√ß√ºk olduƒüu i√ßin fontu k√º√ß√ºltt√ºk */
                line-height: 1.1;
                margin-top: 2px;
                white-space: nowrap; /* ƒ∞smin alt satƒ±ra kayƒ±p ta≈ümasƒ±nƒ± engeller */
                overflow: hidden;
                text-overflow: ellipsis; /* Sƒ±ƒümayan uzun isimleri ... ile bitirir */
            }

        .city-cell.has-winner .city-number,
        .city-cell.has-winner .city-name {
            color: var(--gold);
            opacity: 1;
        }

        .city-cell.no-participant {
            display: none;
        }

        /* Male/Female specific styles */
        .pane-male .city-cell:hover {
            border-color: var(--primary-blue);
            box-shadow: var(--shadow-glow-blue);
        }

        .pane-female .city-cell:hover {
            border-color: var(--primary-pink);
            box-shadow: var(--shadow-glow-pink);
        }

        /* Winners Content */
        #winnersContent {
            width: 100%;
            max-width: 1200px;
        }

        .winners-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .winners-header h2 {
            font-family: 'Playfair Display', serif;
            font-size: 32px;
            margin-bottom: 10px;
            background: var(--gradient-gold);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .winners-header p {
            color: var(--text-muted);
            font-size: 14px;
        }

        .vote-status {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
        }

        .vote-status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .vote-status-item.voted {
            color: var(--success);
        }

        .vote-status-item.available {
            color: var(--text-muted);
        }

        .winners-section {
            margin-bottom: 50px;
        }

        .winners-section h3 {
            font-size: 18px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .winners-section.male h3 {
            color: var(--primary-blue);
        }

        .winners-section.female h3 {
            color: var(--primary-pink);
        }

        .winners-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px;
        }

        .winner-card-mini {
            background: var(--surface);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.05);
            transition: all 0.3s ease;
        }

        .winner-card-mini:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .winner-card-mini img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--gold);
            margin-bottom: 12px;
        }

        .winner-card-mini h4 {
            font-size: 14px;
            margin-bottom: 5px;
        }

        .winner-card-mini .city-badge {
            font-size: 11px;
            color: var(--gold);
            margin-bottom: 8px;
        }

        .winner-card-mini .instagram-link {
            font-size: 11px;
            color: #E4405F;
            text-decoration: none;
            display: block;
            margin-bottom: 12px;
        }

        .winner-card-mini .btn-vote {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--gradient-gold);
            color: var(--dark);
        }

        .winner-card-mini .btn-vote:hover {
            transform: scale(1.02);
        }

        /* Info Bar */
        .info-bar {
            background: var(--surface);
            border-left: 4px solid var(--primary-blue);
            padding: 20px 25px;
            margin: 20px 30px;
            border-radius: 0 12px 12px 0;
        }

        .info-bar p {
            font-size: 13px;
            color: var(--text-muted);
            line-height: 1.8;
        }

        .info-bar strong {
            color: var(--text);
        }

        /* Footer */
        footer {
            background: var(--darker);
            border-top: 1px solid rgba(255,255,255,0.05);
            padding: 30px;
            text-align: center;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
        }

        .footer-links a {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 13px;
            transition: color 0.3s ease;
        }

        .footer-links a:hover {
            color: var(--primary-blue);
        }

        .footer-copy {
            font-size: 12px;
            color: var(--text-muted);
            opacity: 0.6;
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: var(--surface);
            padding: 35px;
            border-radius: 24px;
            width: 100%;
            max-width: 480px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: var(--shadow-lg);
            animation: modalSlide 0.3s ease;
        }

        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .modal-header h3 {
            font-family: 'Playfair Display', serif;
            font-size: 26px;
            margin-bottom: 8px;
        }

        .modal-header p {
            color: var(--text-muted);
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group label .required {
            color: var(--error);
        }

        .form-input {
            width: 100%;
            padding: 14px 18px;
            background: var(--surface-light);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            color: var(--text);
            font-size: 15px;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 4px rgba(0, 102, 204, 0.1);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        .form-hint {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            background: rgba(0, 102, 204, 0.1);
            border: 1px solid rgba(0, 102, 204, 0.2);
            border-radius: 10px;
            padding: 12px;
            margin-top: 10px;
            font-size: 12px;
            color: var(--primary-blue);
        }

        .form-file {
            width: 100%;
            padding: 20px;
            background: var(--surface-light);
            border: 2px dashed rgba(255,255,255,0.1);
            border-radius: 12px;
            color: var(--text-muted);
            font-size: 14px;
            cursor: pointer;
            text-align: center;
        }

        .privacy-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid rgba(212, 175, 55, 0.2);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
        }

        .privacy-checkbox input {
            width: 20px;
            height: 20px;
            accent-color: var(--gold);
            margin-top: 2px;
        }

        .privacy-checkbox span {
            font-size: 13px;
            color: var(--text-muted);
            line-height: 1.5;
        }

        .privacy-checkbox a {
            color: var(--primary-blue);
            text-decoration: none;
        }

        .btn-submit {
            width: 100%;
            padding: 16px;
            background: var(--gradient-gold);
            color: var(--dark);
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(212, 175, 55, 0.3);
        }

        .btn-submit:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .btn-cancel {
            width: 100%;
            padding: 14px;
            background: transparent;
            color: var(--text-muted);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 12px;
            transition: all 0.3s ease;
        }

        .btn-cancel:hover {
            background: var(--surface-light);
        }

        /* Vote Modal */
        #voteModal .modal-content {
            max-width: 500px;
        }

        .candidate-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .candidate-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 12px;
            margin-bottom: 10px;
            background: var(--surface-light);
            transition: all 0.3s ease;
        }

        .candidate-item:hover {
            border-color: rgba(255,255,255,0.1);
        }

        .candidate-item.leader {
            border-color: var(--gold);
            background: rgba(212, 175, 55, 0.05);
        }

        .candidate-item .crown {
            font-size: 24px;
            margin-right: 10px;
        }

        .candidate-item img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 15px;
        }

        .candidate-item.leader img {
            border: 2px solid var(--gold);
        }

        .candidate-info {
            flex: 1;
        }

        .candidate-info h4 {
            font-size: 15px;
            margin-bottom: 4px;
        }

        .candidate-info .instagram-link {
            font-size: 12px;
            color: #E4405F;
            text-decoration: none;
        }

        .candidate-info .votes {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .btn-vote-small {
            padding: 10px 20px;
            background: var(--gradient-blue);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-vote-small:hover {
            transform: scale(1.05);
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--surface);
            border-radius: 12px;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: var(--shadow-lg);
            z-index: 2000;
            opacity: 0;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .toast-success .toast-icon {
            background: var(--success);
            color: white;
        }

        .toast-error .toast-icon {
            background: var(--error);
            color: white;
        }

        .toast-warning .toast-icon {
            background: var(--warning);
            color: var(--dark);
        }

        .toast-info .toast-icon {
            background: var(--primary-blue);
            color: white;
        }

        .toast-message {
            font-size: 14px;
            color: var(--text);
        }

        /* Loading Spinner */
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(0,0,0,0.1);
            border-top-color: var(--dark);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        .loading-spinner-small {
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255,255,255,0.2);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Admin Page */
        .admin-header {
            background: linear-gradient(135deg, #8b0000 0%, #dc3545 100%);
        }

        .admin-page {
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .admin-section {
            margin-bottom: 40px;
        }

        .admin-section h2 {
            font-family: 'Playfair Display', serif;
            font-size: 24px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .badge-count {
            background: var(--error);
            color: white;
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 20px;
            font-family: 'DM Sans', sans-serif;
        }

        /* Pending Cards */
        .pending-card {
            background: var(--surface);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid rgba(255,255,255,0.05);
            transition: all 0.3s ease;
        }

        .pending-card:hover {
            border-color: rgba(255,255,255,0.1);
        }

        .pending-card-header {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .pending-avatar {
            width: 100px;
            height: 100px;
            border-radius: 12px;
            object-fit: cover;
        }

        .pending-info {
            flex: 1;
        }

        .pending-info h3 {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .pending-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
        }

        .badge {
            font-size: 11px;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 600;
        }

        .badge-city {
            background: rgba(212, 175, 55, 0.1);
            color: var(--gold);
        }

        .badge-male {
            background: rgba(0, 102, 204, 0.1);
            color: var(--primary-blue);
        }

        .badge-female {
            background: rgba(204, 0, 102, 0.1);
            color: var(--primary-pink);
        }

        .instagram-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: #E4405F;
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
        }

        .instagram-link:hover {
            text-decoration: underline;
        }

        .pending-actions {
            display: flex;
            gap: 10px;
        }

        .btn-approve {
            flex: 1;
            padding: 12px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-approve:hover {
            background: #00a040;
        }

        .btn-reject {
            flex: 1;
            padding: 12px;
            background: var(--error);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-reject:hover {
            background: #d01030;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        /* DB Stats */
        .db-stats {
            background: var(--surface);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .db-stats h4 {
            font-size: 16px;
            margin-bottom: 15px;
        }

        .db-stats p {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        .progress-bar {
            height: 8px;
            background: var(--surface-light);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--success);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .db-warning .progress-fill {
            background: var(--error);
        }

        .db-percentage {
            font-size: 12px !important;
            margin-top: 8px;
        }

        .db-alert {
            color: var(--error) !important;
            font-weight: 600;
            margin-top: 15px;
        }

        /* Turkey Winners Admin */
        #turkeyWinnersAdmin {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .winner-card {
            background: var(--surface);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            border: 2px solid var(--accent-color, var(--gold));
            position: relative;
            overflow: hidden;
        }

        .winner-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: linear-gradient(180deg, rgba(212,175,55,0.1) 0%, transparent 100%);
        }

        .winner-badge {
            font-size: 40px;
            margin-bottom: 15px;
            position: relative;
        }

        .winner-card h3 {
            font-size: 14px;
            color: var(--accent-color, var(--gold));
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
            position: relative;
        }

        .winner-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--gold);
            margin-bottom: 15px;
            position: relative;
        }

        .winner-card h2 {
            font-family: 'Playfair Display', serif;
            font-size: 22px;
            margin-bottom: 5px;
            position: relative;
        }

        .winner-city {
            color: var(--text-muted);
            font-size: 14px;
            margin-bottom: 20px;
            position: relative;
        }

        .winner-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            position: relative;
        }

        .stat {
            background: var(--surface-light);
            padding: 12px 20px;
            border-radius: 12px;
        }

        .stat-highlight {
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .stat-value {
            display: block;
            font-size: 24px;
            font-weight: 700;
            color: var(--gold);
        }

        .stat-label {
            font-size: 11px;
            color: var(--text-muted);
        }

        .winner-instagram {
            display: inline-block;
            background: #E4405F;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            font-size: 13px;
            position: relative;
        }

        .winner-card-empty {
            border-style: dashed;
            border-color: rgba(255,255,255,0.1);
        }

        .winner-card-empty h3 {
            color: var(--text-muted);
        }

        .winner-card-empty p {
            color: var(--text-muted);
        }

        /* Contact & Privacy Pages */
        .page-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 30px;
        }

        .content-card {
            background: var(--surface);
            border-radius: 20px;
            padding: 40px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .content-card h2 {
            font-family: 'Playfair Display', serif;
            font-size: 28px;
            margin-bottom: 25px;
        }

        .content-card p {
            color: var(--text-muted);
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .content-card h3 {
            color: var(--primary-blue);
            font-size: 18px;
            margin: 30px 0 15px;
        }

        .content-card ul {
            color: var(--text-muted);
            line-height: 2;
            padding-left: 25px;
        }

        .contact-info {
            background: var(--surface-light);
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
        }

        .contact-info p {
            margin: 10px 0;
        }

        .alert-box {
            background: rgba(212, 175, 55, 0.1);
            border-left: 4px solid var(--gold);
            border-radius: 0 12px 12px 0;
            padding: 20px;
            margin-top: 25px;
        }

        .alert-box p {
            color: var(--gold);
            font-size: 13px;
            margin: 0;
        }

        .success-box {
            background: rgba(0, 200, 83, 0.1);
            border-left: 4px solid var(--success);
            border-radius: 0 12px 12px 0;
            padding: 20px;
            margin-top: 25px;
        }

        .success-box p {
            color: var(--success);
            font-size: 13px;
            margin: 0;
        }

        .city-count {
    font-size: 9px;
    color: var(--success); /* Ye≈üil renk dikkat √ßeker */
    margin-top: 2px;
    font-weight: 600;
    letter-spacing: -0.2px;
}

/* Mobil uyumluluk i√ßin (en alttaki media query i√ßine ekle) */
@media (max-width: 768px) {
    .map-grid {
        /* Tablettte 5 yerine 4 s√ºtun */
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
    }
    
    /* ƒ∞simlerin g√∂r√ºn√ºrl√ºƒü√ºn√º garantiye alalƒ±m */
    .city-cell .city-name {
        display: block;
        font-size: 8px; /* Biraz b√ºy√ºtt√ºk */
        margin-top: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100%;
    }
}

/* Mobil (480px altƒ± - Telefonlar) */
@media (max-width: 480px) {
    .map-grid {
        /* Mobilde 4 yerine 3 s√ºtun yapƒ±yoruz, kartlar geni≈üliyor */
        grid-template-columns: repeat(3, 1fr);
        gap: 6px;
    }

    .city-cell .city-number {
        font-size: 10px;
    }

    .city-cell .city-name {
        font-size: 9px; /* Mobilde okunabilirliƒüi artƒ±rdƒ±k */
    }

    .city-count {
        font-size: 8px; /* Katƒ±lƒ±mcƒ± yazƒ±sƒ± */
    }
}

        /* Responsive */
      /* --- RESPONSIVE AYARLAR (MOBƒ∞L VE TABLET) --- */

    /* Tablet (768px ve altƒ±) */
    @media (max-width: 768px) {
        header {
            padding: 15px 20px;
        }

        .logo {
            font-size: 22px;
        }

        .map-grid {
            /* Tablette 4 s√ºtun */
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        /* ƒ∞simlerin g√∂r√ºnmesini garantiye alƒ±yoruz */
        .city-cell .city-name {
            display: block !important;
            font-size: 8px;
            margin-top: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .info-bar {
            margin: 15px;
            padding: 15px;
        }

        .winners-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        #turkeyWinnersAdmin {
            grid-template-columns: 1fr;
        }
    }

    /* Mobil (480px ve altƒ± - Telefonlar) */
    @media (max-width: 480px) {
        .map-grid {
            /* Mobilde 3 s√ºtun yapƒ±yoruz */
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
        }

        .city-cell {
            /* Kartlarƒ± boyuna uzatƒ±yoruz ki resim + plaka + isim + sayƒ± sƒ±ƒüsƒ±n */
            aspect-ratio: 0.75; 
            padding: 4px;
        }

        .city-cell .city-avatar {
            width: 55%; /* Resmi biraz k√º√ß√ºlt√ºp yer a√ßalƒ±m */
            height: 55%;
        }

        .city-cell .city-number {
            font-size: 9px;
            margin-top: 2px;
        }

        .city-cell .city-name {
            font-size: 8px; /* ƒ∞sim boyutu */
            line-height: 1.2;
            display: block !important; /* Kesinlikle g√∂r√ºn√ºr olsun */
        }

        .city-count {
            font-size: 7px; /* Katƒ±lƒ±mcƒ± sayƒ±sƒ± boyutu */
            margin-top: 1px;
        }

        .vote-status {
            flex-direction: column;
            gap: 10px;
        }
    }
    </style>
</head>

<body>

    <!-- Main Page -->
    <div id="mainPage">
        <header>
            <div class="logo">harita<span>.info</span></div>
            <div id="joinArea"></div>
        </header>

        <div class="tab-controls">
            <button class="tab-btn active-male" id="btnM" onclick="switchTab('male')">‚ôÇ ERKEKLER</button>
            <button class="tab-btn" id="btnF" onclick="switchTab('female')">‚ôÄ KADINLAR</button>
            <button class="tab-btn" id="btnW" onclick="switchTab('winners')">üèÜ T√úRKƒ∞YE Bƒ∞Rƒ∞NCƒ∞LERƒ∞</button>
        </div>

        <div class="container">
            <div class="pane pane-male mobile-active" id="paneMale">
                <div id="mapMale" class="map-grid"></div>
            </div>
            <div class="pane pane-female" id="paneFemale">
                <div id="mapFemale" class="map-grid"></div>
            </div>
            <div class="pane pane-winners mobile-active" id="paneWinners" style="display:none;">
                <div id="winnersContent"></div>
            </div>
        </div>

        <div class="info-bar">
            <p>
    ‚ÑπÔ∏è <strong>Oylama Kurallarƒ±:</strong> 
    Yalnƒ±zca <strong>1 erkek</strong> ve <strong>1 kadƒ±n</strong> aday i√ßin oy kullanabilirsiniz. 
    L√ºtfen oyunuzu <strong>ya≈üadƒ±ƒüƒ±nƒ±z ≈üehir</strong> i√ßin kullanƒ±nƒ±z.
    T√ºrkiye Birinciliƒüi i√ßin ayrƒ±ca <strong>1 erkek</strong> ve <strong>1 kadƒ±n</strong> aday i√ßin oy hakkƒ±nƒ±z bulunmaktadƒ±r.
    <br><br>
    üì£ <strong>T√ºrkiye birincileri <a href="https://instagram.com/enharitalar" target="_blank" style="color: var(--gradient-gold); text-decoration: none;">@enharitalar</a> Instagram hesabƒ±ndan payla≈üƒ±lacaktƒ±r.</strong>
</p>
        </div>

        <footer>
            <div class="footer-links">
                <a href="/iletisim" onclick="showPage('contact'); return false;">üìß ƒ∞leti≈üim</a>
                <a href="/gizlilik" onclick="showPage('privacy'); return false;">üîí Gizlilik Politikasƒ±</a>
            </div>
            <p class="footer-copy">¬© 2024 harita.info - T√ºm haklarƒ± saklƒ±dƒ±r. KVKK kapsamƒ±nda ki≈üisel verileriniz korunmaktadƒ±r.</p>
        </footer>
    </div>

    <!-- Contact Page -->
    <div id="contactPage" style="display:none;">
        <header>
            <div class="logo">harita<span>.info</span></div>
            <a href="/" onclick="showPage('main'); return false;" class="btn-join" style="background: var(--surface);">‚Üê Ana Sayfa</a>
        </header>
        <div class="page-content">
            <div class="content-card">
                <h2>üìß Bize Ula≈üƒ±n</h2>
                <p>Sorularƒ±nƒ±z, √∂nerileriniz veya ≈üikayetleriniz i√ßin bizimle ileti≈üime ge√ßebilirsiniz.</p>
                <div class="contact-info">
                    <p><strong>üìß E-posta:</strong> <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d1b4bfb9b0a3b8a5b0bdb0a391b6bcb0b8bdffb2bebc">[enharitalar@gmail.com&#160;]</a></p>
                    <p><strong>üì∑ Instagram:</strong> @enharitalar</p>
                </div>
                <div class="alert-box">
                    <p>‚ö†Ô∏è <strong>√ñnemli:</strong> Yarƒ±≈üma ile ilgili itirazlarƒ±nƒ±zƒ± en ge√ß yarƒ±≈üma biti≈ü tarihinden 7 g√ºn sonrasƒ±na kadar iletebilirsiniz.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Privacy Page -->
    <div id="privacyPage" style="display:none;">
        <header>
            <div class="logo">harita<span>.info</span></div>
            <a href="/" onclick="showPage('main'); return false;" class="btn-join" style="background: var(--surface);">‚Üê Ana Sayfa</a>
        </header>
        <div class="page-content">
            <div class="content-card">
                <h2>üîí Gizlilik Politikasƒ± ve KVKK Aydƒ±nlatma Metni</h2>
                
                <h3>1. Veri Sorumlusu</h3>
                <p>6698 sayƒ±lƒ± Ki≈üisel Verilerin Korunmasƒ± Kanunu ("KVKK") uyarƒ±nca, harita.info olarak veri sorumlusu sƒ±fatƒ±yla ki≈üisel verilerinizi a≈üaƒüƒ±da a√ßƒ±klanan ama√ßlar ve hukuki sebepler √ßer√ßevesinde i≈ülemekteyiz.</p>
                
                <h3>2. ƒ∞≈ülenen Ki≈üisel Veriler</h3>
                <p>Yarƒ±≈ümaya katƒ±lƒ±m sƒ±rasƒ±nda a≈üaƒüƒ±daki ki≈üisel verileriniz toplanmaktadƒ±r:</p>
                <ul>
                    <li><strong>Kimlik Verileri:</strong> Ad Soyad</li>
                    <li><strong>ƒ∞leti≈üim Verileri:</strong> Instagram Kullanƒ±cƒ± Adƒ±</li>
                    <li><strong>Lokasyon Verileri:</strong> ƒ∞l Bilgisi (Plaka Kodu)</li>
                    <li><strong>G√∂rsel ve ƒ∞≈üitsel Veriler:</strong> Profil Fotoƒürafƒ±</li>
                    <li><strong>Demografik Veriler:</strong> Cinsiyet</li>
                    <li><strong>ƒ∞≈ülem G√ºvenliƒüi Verileri:</strong> IP Adresi, Onay Tarihi ve Saati, Tarayƒ±cƒ± Bilgisi (User Agent)</li>
                </ul>

                <h3>3. Ki≈üisel Verilerin ƒ∞≈ülenme Ama√ßlarƒ±</h3>
                <p>Toplanan ki≈üisel verileriniz a≈üaƒüƒ±daki ama√ßlarla i≈ülenmektedir:</p>
                <ul>
                    <li>Yarƒ±≈üma katƒ±lƒ±mƒ±nƒ±n saƒülanmasƒ± ve yarƒ±≈ümanƒ±n y√ºr√ºt√ºlmesi</li>
                    <li>Yarƒ±≈ümacƒ±larƒ±n platformda g√∂r√ºnt√ºlenmesi</li>
                    <li>Oylama s√ºre√ßlerinin y√∂netimi ve takibi</li>
                    <li>Kazananlarƒ±n belirlenmesi ve duyurulmasƒ±</li>
                    <li>Yasal y√ºk√ºml√ºl√ºklerin yerine getirilmesi</li>
                    <li>Uyu≈ümazlƒ±k durumunda delil te≈ükil etmesi</li>
                    <li>√áift oy kullanƒ±mƒ±nƒ±n engellenmesi</li>
                </ul>

                <h3>4. Ki≈üisel Verilerin ƒ∞≈ülenme Hukuki Sebepleri</h3>
                <p>Ki≈üisel verileriniz KVKK'nƒ±n 5. maddesinde belirtilen a≈üaƒüƒ±daki hukuki sebeplere dayanarak i≈ülenmektedir:</p>
                <ul>
                    <li><strong>A√ßƒ±k Rƒ±zanƒ±z:</strong> Ba≈üvuru formunda onay kutusunu i≈üaretleyerek verdiƒüiniz a√ßƒ±k rƒ±za</li>
                    <li><strong>S√∂zle≈ümenin ƒ∞fasƒ±:</strong> Yarƒ±≈üma katƒ±lƒ±m ko≈üullarƒ±nƒ±n yerine getirilmesi</li>
                    <li><strong>Hukuki Y√ºk√ºml√ºl√ºk:</strong> Yasal d√ºzenlemelere uyum saƒülanmasƒ±</li>
                    <li><strong>Me≈üru Menfaat:</strong> Yarƒ±≈ümanƒ±n d√ºzg√ºn i≈üleyi≈üinin saƒülanmasƒ±</li>
                </ul>

                <h3>5. Ki≈üisel Verilerin Aktarƒ±mƒ±</h3>
                <p>Ki≈üisel verileriniz a≈üaƒüƒ±daki durumlarda payla≈üƒ±lmaktadƒ±r:</p>
                <ul>
                    <li><strong>Platform Kullanƒ±cƒ±larƒ±:</strong> Ad, fotoƒüraf, ≈üehir ve Instagram bilgileriniz yarƒ±≈ümanƒ±n doƒüasƒ± gereƒüi diƒüer kullanƒ±cƒ±larla payla≈üƒ±lmaktadƒ±r</li>
                    <li><strong>Teknik Altyapƒ±:</strong> Firebase (Google) altyapƒ±sƒ± kullanƒ±larak veriler g√ºvenli sunucularda saklanmaktadƒ±r</li>
                    <li><strong>Yasal Merciler:</strong> Yasal zorunluluklar dahilinde yetkili kamu kurum ve kurulu≈ülarƒ± ile payla≈üƒ±labilir</li>
                </ul>

                <h3>6. Ki≈üisel Verilerin Saklanma S√ºresi</h3>
                <p>Ki≈üisel verileriniz:</p>
                <ul>
                    <li>Yarƒ±≈üma s√ºresince aktif olarak i≈ülenir</li>
                    <li>Yarƒ±≈üma bitiminden itibaren 1 yƒ±l s√ºreyle yasal y√ºk√ºml√ºl√ºkler i√ßin saklanƒ±r</li>
                    <li>Kazananlarƒ±n verileri, a√ßƒ±k rƒ±zalarƒ± dahilinde daha uzun s√ºre saklanabilir</li>
                    <li>Saklama s√ºresi sonunda veriler g√ºvenli bir ≈üekilde silinir, yok edilir veya anonim hale getirilir</li>
                </ul>

                <h3>7. Ki≈üisel Verilerin G√ºvenliƒüi</h3>
                <p>Verilerinizin g√ºvenliƒüi i√ßin alƒ±nan tedbirler:</p>
                <ul>
                    <li>SSL sertifikasƒ± ile ≈üifreli baƒülantƒ±</li>
                    <li>Firebase g√ºvenlik kurallarƒ± ile korunan veritabanƒ±</li>
                    <li>Moderasyon sistemi ile i√ßerik kontrol√º</li>
                    <li>IP bazlƒ± oy kullanma sƒ±nƒ±rlamasƒ±</li>
                    <li>Yetkisiz eri≈üimlere kar≈üƒ± g√ºvenlik duvarƒ±</li>
                </ul>

                <h3>8. KVKK Kapsamƒ±ndaki Haklarƒ±nƒ±z</h3>
                <p>KVKK'nƒ±n 11. maddesi uyarƒ±nca sahip olduƒüunuz haklar:</p>
                <ul>
                    <li>Ki≈üisel verilerinizin i≈ülenip i≈ülenmediƒüini √∂ƒürenme</li>
                    <li>ƒ∞≈ülenmi≈üse buna ili≈ükin bilgi talep etme</li>
                    <li>ƒ∞≈ülenme amacƒ±nƒ± ve bunlarƒ±n amacƒ±na uygun kullanƒ±lƒ±p kullanƒ±lmadƒ±ƒüƒ±nƒ± √∂ƒürenme</li>
                    <li>Yurt i√ßinde veya yurt dƒ±≈üƒ±nda aktarƒ±ldƒ±ƒüƒ± √º√ß√ºnc√º ki≈üileri bilme</li>
                    <li>Eksik veya yanlƒ±≈ü i≈ülenmi≈üse d√ºzeltilmesini isteme</li>
                    <li>KVKK'nƒ±n 7. maddesinde √∂ng√∂r√ºlen ≈üartlar √ßer√ßevesinde silinmesini veya yok edilmesini isteme</li>
                    <li>D√ºzeltme veya silme i≈ülemlerinin aktarƒ±ldƒ±ƒüƒ± √º√ß√ºnc√º ki≈üilere bildirilmesini isteme</li>
                    <li>M√ºnhasƒ±ran otomatik sistemler vasƒ±tasƒ±yla analiz edilmesi suretiyle aleyhinize bir sonucun ortaya √ßƒ±kmasƒ±na itiraz etme</li>
                    <li>Kanuna aykƒ±rƒ± olarak i≈ülenmesi sebebiyle zarara uƒüramanƒ±z halinde zararƒ±n giderilmesini talep etme</li>
                </ul>

                <h3>9. √áerez (Cookie) Politikasƒ±</h3>
                <p>Sitemizde kullanƒ±lan √ßerezler:</p>
                <ul>
                    <li><strong>Oturum √áerezleri:</strong> Oy kullanma i≈ülemlerini takip etmek i√ßin</li>
                    <li><strong>Tercih √áerezleri:</strong> Kullanƒ±cƒ± tercihlerini hatƒ±rlamak i√ßin</li>
                    <li><strong>Analitik √áerezler:</strong> Site kullanƒ±mƒ±nƒ± analiz etmek i√ßin</li>
                </ul>
                <p>√áerezleri tarayƒ±cƒ± ayarlarƒ±nƒ±zdan devre dƒ±≈üƒ± bƒ±rakabilirsiniz, ancak bu durumda bazƒ± √∂zellikler √ßalƒ±≈ümayabilir.</p>

                <h3>10. Veri ƒ∞hlali Durumunda</h3>
                <p>Olasƒ± bir veri ihlali durumunda:</p>
                <ul>
                    <li>72 saat i√ßinde Ki≈üisel Verileri Koruma Kurumu'na bildirim yapƒ±lƒ±r</li>
                    <li>Etkilenen kullanƒ±cƒ±lar en kƒ±sa s√ºrede bilgilendirilir</li>
                    <li>ƒ∞hlali √∂nlemek i√ßin gerekli tedbirler alƒ±nƒ±r</li>
                </ul>

                <h3>11. ƒ∞leti≈üim</h3>
                <p>KVKK kapsamƒ±ndaki haklarƒ±nƒ±zƒ± kullanmak veya sorularƒ±nƒ±z i√ßin:</p>
                <p><strong>E-posta:</strong> enharitalar@gmail.com</p>
                
                
                <div style="background: var(--primary-light); padding: 15px; border-radius: 8px; margin-top: 20px;">
                    <p><strong>üìå Not:</strong> Ba≈üvuru formunda "Gizlilik Politikasƒ±'nƒ± okudum ve kabul ediyorum" kutusunu i≈üaretleyerek, yukarƒ±da belirtilen t√ºm ≈üartlarƒ± kabul etmi≈ü sayƒ±lƒ±rsƒ±nƒ±z. Bu onay, IP adresiniz ve zaman bilgisi ile birlikte kaydedilmektedir.</p>
                </div>
                
                <!-- Ba≈üvuru Formuna Geri D√∂n Butonu -->
                <div style="text-align: center; margin-top: 30px;">
                    <button onclick="showPage('main'); document.getElementById('uploadModal').style.display='flex';" 
                            style="background: linear-gradient(135deg, var(--primary), var(--primary-dark)); 
                                   color: white; 
                                   padding: 12px 30px; 
                                   border: none; 
                                   border-radius: 8px; 
                                   font-size: 16px; 
                                   font-weight: 600; 
                                   cursor: pointer;
                                   display: inline-flex;
                                   align-items: center;
                                   gap: 8px;
                                   transition: all 0.3s ease;">
                        ‚Üê Ba≈üvuru Formuna Geri D√∂n
                    </button>
                </div>
                    <li>ƒ∞≈ülenen verilerin d√ºzeltilmesini talep etme</li>
                </ul>

                <div class="success-box">
                    <p>‚úÖ Yarƒ±≈ümaya katƒ±larak bu gizlilik politikasƒ±nƒ± kabul etmi≈ü sayƒ±lƒ±rsƒ±nƒ±z.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Page -->
    <div id="adminPage" style="display:none;">
        <header class="admin-header">
            <div class="logo">üîê Moderasyon</div>
            <a href="/" onclick="showPage('main'); return false;" class="btn-join" style="background: rgba(238, 11, 11, 0.2);">‚Üê Ana Sayfa</a>
        </header>
        <div class="admin-page">
            <div id="dbStats"></div>
            
            <div class="admin-section">
                <h2>Bekleyen Ba≈üvurular <span class="badge-count" id="pendingCount">0</span></h2>
                <div id="modPanel"></div>
            </div>

            <div class="admin-section">
                <h2>üèÜ T√ºrkiye Birincileri</h2>
                <div id="turkeyWinnersAdmin"></div>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üèÜ Yarƒ±≈ümaya Katƒ±l</h3>
                <p>Bilgilerinizi eksiksiz doldurun</p>
            </div>

            <div class="form-group">
                <label>Cinsiyet <span class="required">*</span></label>
                <select id="upGender" class="form-input">
                    <option value="male">üë® Erkek</option>
                    <option value="female">üë© Kadƒ±n</option>
                </select>
            </div>

            <div class="form-group">
                <label>ƒ∞l Plaka Kodu <span class="required">*</span></label>
                <input type="number" id="upCity" class="form-input" placeholder="1-81 arasƒ± plaka kodu girin" min="1" max="81">
            </div>

            <div class="form-group">
                <label>Ad Soyad <span class="required">*</span></label>
                <input type="text" id="upName" class="form-input" placeholder="Adƒ±nƒ±z ve soyadƒ±nƒ±z">
            </div>

            <div class="form-group">
                <label>Instagram <span class="required">*</span></label>
                <input type="text" id="upInstagram" class="form-input" placeholder="@kullanici_adi">
                <div class="form-hint">
                    <span>üí°</span>
                    <span>Instagram hesabƒ±nƒ±z profilinizde g√∂r√ºnt√ºlenecek ve kazandƒ±ƒüƒ±nƒ±zda duyurulacak.</span>
                </div>
            </div>

            <div class="form-group">
                <label>Fotoƒüraf <span class="required">*</span></label>
                <input type="file" id="upFile" class="form-file" accept="image/*">
                <p style="font-size: 11px; color: var(--text-muted); margin-top: 8px;">‚ö†Ô∏è Maksimum 3MB</p>
            </div>

            <div class="form-group">
                <label class="privacy-checkbox">
                    <input type="checkbox" id="privacyAccept">
                    <span>
                        <a href="javascript:void(0)" onclick="closeModal('uploadModal'); showPage('privacy');">Gizlilik Politikasƒ±</a>'nƒ± okudum ve kabul ediyorum. Ki≈üisel verilerimin yarƒ±≈üma s√ºresince i≈ülenmesine onay veriyorum.
                    </span>
                </label>
            </div>

            <button class="btn-submit" id="submitBtn" onclick="submitAday()">
                üì§ Ba≈üvuruyu G√∂nder
            </button>
            <button class="btn-cancel" onclick="closeModal('uploadModal')">
                ‚úï ƒ∞ptal
            </button>
        </div>
    </div>

    <!-- Vote Modal -->
    <div id="voteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="vTitle">≈ûehir Adaylarƒ±</h3>
            </div>
            <div id="candidateList" class="candidate-list"></div>
            <button class="btn-cancel" onclick="closeModal('voteModal')">Kapat</button>
        </div>
    </div>

    <script>
        const cityNames = ["Adana", "Adƒ±yaman", "Afyon", "Aƒürƒ±", "Amasya", "Ankara", "Antalya", "Artvin", "Aydƒ±n", "Balƒ±kesir", "Bilecik", "Bing√∂l", "Bitlis", "Bolu", "Burdur", "Bursa", "√áanakkale", "√áankƒ±rƒ±", "√áorum", "Denizli", "Diyarbakƒ±r", "Edirne", "Elazƒ±ƒü", "Erzincan", "Erzurum", "Eski≈üehir", "Gaziantep", "Giresun", "G√ºm√º≈ühane", "Hakkari", "Hatay", "Isparta", "Mersin", "ƒ∞stanbul", "ƒ∞zmir", "Kars", "Kastamonu", "Kayseri", "Kƒ±rklareli", "Kƒ±r≈üehir", "Kocaeli", "Konya", "K√ºtahya", "Malatya", "Manisa", "K.Mara≈ü", "Mardin", "Muƒüla", "Mu≈ü", "Nev≈üehir", "Niƒüde", "Ordu", "Rize", "Sakarya", "Samsun", "Siirt", "Sinop", "Sivas", "Tekirdaƒü", "Tokat", "Trabzon", "Tunceli", "≈ûanlƒ±urfa", "U≈üak", "Van", "Yozgat", "Zonguldak", "Aksaray", "Bayburt", "Karaman", "Kƒ±rƒ±kkale", "Batman", "≈ûƒ±rnak", "Bartƒ±n", "Ardahan", "Iƒüdƒ±r", "Yalova", "Karab√ºk", "Kilis", "Osmaniye", "D√ºzce"];

        window.cityNames = cityNames;

        function switchTab(g) {
            document.getElementById('paneMale').classList.toggle('mobile-active', g === 'male');
            document.getElementById('paneFemale').classList.toggle('mobile-active', g === 'female');
            document.getElementById('paneWinners').classList.toggle('mobile-active', g === 'winners');
            
            document.getElementById('paneMale').style.display = g === 'male' ? 'flex' : 'none';
            document.getElementById('paneFemale').style.display = g === 'female' ? 'flex' : 'none';
            document.getElementById('paneWinners').style.display = g === 'winners' ? 'flex' : 'none';
            
            document.getElementById('btnM').classList.toggle('active-male', g === 'male');
            document.getElementById('btnF').classList.toggle('active-female', g === 'female');
            document.getElementById('btnW').classList.toggle('active-winners', g === 'winners');

            if (g === 'winners') {
                renderWinners();
            }
        }

        // Rastgele sƒ±ralama
        function shuffleArray(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        // Her ilin birincilerini bul
        function getCityWinners() {
            const maleWinners = [];
            const femaleWinners = [];

            for (let i = 1; i <= 81; i++) {
                const maleLeader = (window.adaylar || [])
                    .filter(a => a.city == i && a.gender === 'male')
                    .sort((a, b) => (b.votes || 0) - (a.votes || 0))[0];
                const femaleLeader = (window.adaylar || [])
                    .filter(a => a.city == i && a.gender === 'female')
                    .sort((a, b) => (b.votes || 0) - (a.votes || 0))[0];

                if (maleLeader) maleWinners.push({ ...maleLeader, cityName: cityNames[i - 1] });
                if (femaleLeader) femaleWinners.push({ ...femaleLeader, cityName: cityNames[i - 1] });
            }

            return { maleWinners, femaleWinners };
        }

        // T√ºrkiye Birincileri sekmesini render et
        function renderWinners() {
            const container = document.getElementById('winnersContent');
            if (!container) return;

            const { maleWinners, femaleWinners } = getCityWinners();
            const shuffledMale = shuffleArray(maleWinners);
            const shuffledFemale = shuffleArray(femaleWinners);

            const maleVoted = localStorage.getItem('turkey_vote_male');
            const femaleVoted = localStorage.getItem('turkey_vote_female');

            const renderCard = (a) => `
                <div class="winner-card-mini">
                    <img src="${a.img}" alt="${a.name}" loading="lazy">
                    <h4>${a.name}</h4>
                    <div class="city-badge">${a.city} - ${a.cityName}</div>
                    ${a.instagram ? `<a href="https://instagram.com/${a.instagram}" target="_blank" class="instagram-link">üì∑ @${a.instagram}</a>` : ''}
                    <button class="btn-vote" onclick="voteTurkey('${a.id}')">üèÜ T√ºrkiye Oyu</button>
                </div>
            `;

            container.innerHTML = `
                <div class="winners-header">
                    <h2>üèÜ T√ºrkiye Birinciliƒüi Oylamasƒ±</h2>
                    <p>Her il birincisi arasƒ±ndan T√ºrkiye birincisini se√ßin</p>
                    <div class="vote-status">
                        <div class="vote-status-item ${maleVoted ? 'voted' : 'available'}">
                            üë® Erkek: ${maleVoted ? '‚úì Oy Verildi' : '‚óã Oy Hakkƒ±nƒ±z Var'}
                        </div>
                        <div class="vote-status-item ${femaleVoted ? 'voted' : 'available'}">
                            üë© Kadƒ±n: ${femaleVoted ? '‚úì Oy Verildi' : '‚óã Oy Hakkƒ±nƒ±z Var'}
                        </div>
                    </div>
                </div>

                <div class="winners-section male">
                    <h3>üë® Erkek ƒ∞l Birincileri (${shuffledMale.length} ƒ∞l)</h3>
                    <div class="winners-grid">
                        ${shuffledMale.length > 0 ? shuffledMale.map(a => renderCard(a)).join('') : '<p style="color: var(--text-muted);">Hen√ºz erkek birincisi yok</p>'}
                    </div>
                </div>

                <div class="winners-section female">
                    <h3>üë© Kadƒ±n ƒ∞l Birincileri (${shuffledFemale.length} ƒ∞l)</h3>
                    <div class="winners-grid">
                        ${shuffledFemale.length > 0 ? shuffledFemale.map(a => renderCard(a)).join('') : '<p style="color: var(--text-muted);">Hen√ºz kadƒ±n birincisi yok</p>'}
                    </div>
                </div>
            `;
        }

        // Haritalarƒ± render et - Performans optimizasyonu ile
        function renderMaps() {
            // RequestAnimationFrame kullanarak render i≈ülemini optimize et
            requestAnimationFrame(() => {
                const drawMap = (containerId, gender) => {
                    const container = document.getElementById(containerId);
                    if (!container) return;

                    const winners = window.cityWinnersCache[gender] || {};
                    const fragments = document.createDocumentFragment();
                    let hasAnyWinner = false;

                    // HTML string yerine DOM elemanlarƒ± olu≈ütur (daha hƒ±zlƒ±)
                    for (let i = 1; i <= 81; i++) {
                        const winner = winners[i];
                        if (!winner) continue;
                        
                        hasAnyWinner = true;
                        const count = (window.adaylar || []).filter(a => a.city == i && a.gender === gender).length;
                        
                        const cell = document.createElement('div');
                        cell.className = 'city-cell has-winner';
                        cell.onclick = () => openCity(i, gender);
                        
                        // Lazy loading i√ßin IntersectionObserver kullanƒ±labilir
                        cell.innerHTML = `
                            <img src="${winner.img}" alt="${winner.name}" class="city-avatar" loading="lazy">
                            <span class="city-number">${i}</span>
                            <span class="city-name">${cityNames[i - 1]}</span>
                            <span class="city-count">Katƒ±lƒ±mcƒ±: ${count}</span>
                        `;
                        
                        fragments.appendChild(cell);
                    }

                    // ƒ∞√ßeriƒüi temizle ve yeni i√ßeriƒüi ekle
                    container.innerHTML = '';
                    
                    if (hasAnyWinner) {
                        container.appendChild(fragments);
                    } else {
                        container.innerHTML = `
                            <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: var(--text-muted);">
                                <p style="font-size: 48px; margin-bottom: 15px;">üó∫Ô∏è</p>
                                <p>Hen√ºz bu kategoride yarƒ±≈ümacƒ± yok</p>
                            </div>
                        `;
                    }
                };

                // Her iki haritayƒ± da √ßiz
                drawMap('mapMale', 'male');
                drawMap('mapFemale', 'female');
                updateBtn();
            });
        }

        function updateBtn() {
            const joinArea = document.getElementById('joinArea');
            if (!joinArea) return;
            
            if (localStorage.getItem('user_has_joined')) {
                joinArea.innerHTML = `<button class="btn-join btn-joined" disabled>‚úì Ba≈üvurunuz Alƒ±ndƒ±</button>`;
            } else {
                joinArea.innerHTML = `<button class="btn-join" onclick="document.getElementById('uploadModal').style.display='flex'">üèÜ Yarƒ±≈ümacƒ± Ol</button>`;
            }
        }

        function openCity(cityId, gender) {
            const filtered = (window.adaylar || [])
                .filter(a => a.city == cityId && a.gender === gender)
                .sort((a, b) => (b.votes || 0) - (a.votes || 0));

            document.getElementById('vTitle').innerText = `${cityId} - ${cityNames[cityId - 1]} Adaylarƒ±`;
            const list = document.getElementById('candidateList');

            if (filtered.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üîç</div>
                        <p>Bu ≈üehirde hen√ºz aday yok</p>
                    </div>
                `;
            } else {
                list.innerHTML = filtered.map((a, idx) => `
                    <div class="candidate-item ${idx === 0 ? 'leader' : ''}">
                        ${idx === 0 ? '<span class="crown">üëë</span>' : ''}
                        <img src="${a.img}" alt="${a.name}" loading="lazy">
                        <div class="candidate-info">
                            <h4>${a.name}</h4>
                            ${a.instagram ? `<a href="https://instagram.com/${a.instagram}" target="_blank" class="instagram-link">üì∑ @${a.instagram}</a>` : ''}
                            <p class="votes">${a.votes || 0} Oy</p>
                        </div>
                        <button class="btn-vote-small" onclick="vote('${a.id}')">‚≠ê Oy Ver</button>
                    </div>
                `).join('');
            }

            document.getElementById('voteModal').style.display = 'flex';
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        // Sayfa y√ºklendiƒüinde - Optimized initialization
        document.addEventListener('DOMContentLoaded', () => {
            // ƒ∞lk olarak UI'ƒ± hazƒ±rla
            updateBtn();
            switchTab('male');
            
            // Loading indicator ekle
            const containers = ['mapMale', 'mapFemale'];
            containers.forEach(id => {
                const container = document.getElementById(id);
                if (container) {
                    container.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px;">
                            <div class="loading-spinner" style="margin: 0 auto;"></div>
                            <p style="color: var(--text-muted); margin-top: 15px;">Y√ºkleniyor...</p>
                        </div>
                    `;
                }
            });
        });
        
        // Firebase baƒülantƒ±sƒ± kurulduƒüunda ilk render'ƒ± yap
        window.addEventListener('load', () => {
            // Eƒüer data gelmediyse bo≈ü render yap
            setTimeout(() => {
                if (!window.adaylar || window.adaylar.length === 0) {
                    const containers = ['mapMale', 'mapFemale'];
                    containers.forEach(id => {
                        const container = document.getElementById(id);
                        if (container && container.innerHTML.includes('loading-spinner')) {
                            container.innerHTML = `
                                <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: var(--text-muted);">
                                    <p style="font-size: 48px; margin-bottom: 15px;">üó∫Ô∏è</p>
                                    <p>Veriler y√ºkleniyor veya hen√ºz yarƒ±≈ümacƒ± yok</p>
                                </div>
                            `;
                        }
                    });
                }
            }, 3000); // 3 saniye bekle
        });
    </script>
</body>
</html>
